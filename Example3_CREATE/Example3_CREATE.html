<!DOCTYPE html>
<html>
  <head>
   <link href='normalize.css' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
   <style>
		#resultcontainer{
			border:1px solid black;
		}
		button, input{
		margin: 5px 0 5px 0;
		}
	</style>
  
  
  <script>
	var CCAURL = 'http://ns7.askia.com:80/ccawebapi/';
	var token;
	
	//this function is a helper to convert a JSON object into a Form data, so that its treated as Form Data in the HTTP POST, rather than Payload.
	function buildFormBody(obj) {
		var form = [];
		for (var key in obj) {
			if (obj.hasOwnProperty(key)) {
				form.push(encodeURIComponent(key) + "=" + encodeURIComponent(obj[key]));
			}
		}
		return form.join("&");
	}
	
	function init(){
		document.getElementById('doc').innerHTML = CCAURL;
		document.getElementById('doc').setAttribute("href",CCAURL);
		authenticate();
	}
	
	function authenticate(){
		fetch( CCAURL + '/session', {
			method:'post',
			headers:{
				"Content-Type": "application/x-www-form-urlencoded"
			},
			body: buildFormBody({ 
				username : "Supervisor",
				password : "Supervisor",
				module   : "RecordingManagementTool",
			})
		})
		.then(function( response ) {
			if(response.ok){
				return response.json().then(function(json){
					token=json.Response.Token;
					//further proceed with Token
					
					//document.getElementById('result').innerHTML = "Status : " + response.status + "<br>" + "Status text : " + response.statusText + "<br>" + "Current Authenticity token : " + token;
				});
			}
			else{
				document.getElementById('result').innerHTML = "Status : " + response.status + "<br>" + "Status text : " + response.statusText;
			}
		});
	}

    function getAgentJSON(){
		fetch('http://ns7.askia.com:80/ccawebapi/Agents/1',
			{
			headers: {'Authorization': 'Basic ' + token}
			}
		)
		.then(function(response){
			return response.json().then(function(json){
				document.getElementById('result').innerHTML = JSON.stringify(json.Response);
			})
		})
   }
   
   function setAgentJSON(){
		fetch('http://ns7.askia.com:80/ccawebapi/Agents',
		{
			headers: 
			{
				'Authorization': 'Basic ' + token,
				"Content-Type": "application/x-www-form-urlencoded"
			},
			method:'post',
			body: buildFormBody({"Address1":"","Address2":"","AlarmSettings":{"ClericalTime":{"Enabled":false,"Threshold":0},"EnteringNumberTime":{"Enabled":false,"Threshold":0},"ParkedTime":{"Enabled":false,"Threshold":0},"PauseTimes":{},"PausedTime":{"Enabled":false,"Threshold":0},"ReadyTime":{"Enabled":false,"Threshold":0},"RingingTime":{"Enabled":false,"Threshold":0},"SelectingTime":{"Enabled":false,"Threshold":0},"SpeakingTime":{"Enabled":false,"Threshold":0}},"Broker":"","CoverageRouteId":-1,"EmailAddress":"","FirstName":"","LastName":"Administrator01","MaxNumberOfSimultaneousContacts":5,"Memberships":{"CapiGroups":[],"CodingGroups":[],"InboundGroups":[],"OutboundGroupId":-1},"NTAccount":"","ObjectState":{"AgentState":{"AvailableForKeyIn":false,"AvailableForOutbound":false,"AverageWaitingTime":0,"CurrentPauseId":0,"Duty":0,"IPAddress":"","LocationId":-1,"LogOnTime":"0001-01-01T00:00:00","MaxWaitingTime":0,"MinWaitingTime":0,"StartWaitingTime":"0001-01-01T00:00:00","StatusChangeTime":"0001-01-01T00:00:00","StatusId":0},"SupervisorState":{"HostName":"","IPAddress":"","LocationId":-1,"StatusId":0}},"RecordAllCalls":false,"RecordAllCallsInStereo":false,"RestrictionId":1,"Skills":[{"SkillId":2,"Value":0},{"SkillId":1,"Value":0},{"SkillId":3,"Value":0}],"SoftPhoneTraceEnabled":false,"UserName":"Administrator01","CcaObjectType":2,"DefaultId":0,"DateCreated":"2016-04-15T10:08:29","DateModified":"2016-05-10T14:59:57","Description":"","Id":1,"Name":"Administrator01"})
		})
		.then(function(response){
			return response.json().then(function(json){
				document.getElementById('result').innerHTML = JSON.stringify(json.Response);
				console.log(json);
			})
		})
   }
   
   </script>
	</head>

  <body onload="init()">
	<h1>Example 3 : Creation</h1>
	<h2>Documentation about this API can be found at <a id="doc" href=""></a></h2>
	<input type="button" value="Get" onclick="getAgentJSON()"/>
	<input type="button" value="Post" onclick="setAgentJSON()"/>
	
	</head>
    Results : 
	<div id="resultcontainer">
		<div id="loading"></div>
		<ul id="result"></ul>
	</div>

  </body>
</html>